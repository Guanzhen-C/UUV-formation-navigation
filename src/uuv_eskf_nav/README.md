# UUV ESKF Navigation

**åŸºäºè¯¯å·®çŠ¶æ€å¡å°”æ›¼æ»¤æ³¢çš„é€šç”¨æ°´ä¸‹è½½å…·å¯¼èˆªç³»ç»Ÿ**

## ğŸŒŠ é¡¹ç›®æ¦‚è¿°

`uuv_eskf_nav` æ˜¯ä¸€ä¸ªä¸“ä¸ºæ°´ä¸‹è½½å…·(UUV)è®¾è®¡çš„é«˜ç²¾åº¦å¯¼èˆªç³»ç»Ÿï¼ŒåŸºäºè¯¯å·®çŠ¶æ€å¡å°”æ›¼æ»¤æ³¢(Error-State Kalman Filter, ESKF)ç®—æ³•å®ç°å¤šä¼ æ„Ÿå™¨èåˆå¯¼èˆªã€‚

### ğŸ¯ æ ¸å¿ƒç‰¹æ€§

- **ğŸ”¬ é«˜ç²¾åº¦ç®—æ³•**: 15ç»´è¯¯å·®çŠ¶æ€å‘é‡ç²¾ç¡®å»ºæ¨¡
- **ğŸ”§ é€šç”¨è®¾è®¡**: æ”¯æŒä»»æ„UUVä»¿çœŸè½½å…·ï¼Œåªéœ€ä¿®æ”¹robot_nameå‚æ•°
- **ğŸ“¡ å¤šä¼ æ„Ÿå™¨èåˆ**: æ™ºèƒ½èåˆIMUã€DVLã€æ·±åº¦ä¼ æ„Ÿå™¨æ•°æ®
- **âš¡ å®æ—¶æ€§èƒ½**: 30Hz+ å¯¼èˆªæ›´æ–°é¢‘ç‡
- **ğŸ“Š åœ¨çº¿è¯„ä¼°**: å®æ—¶å¯¼èˆªç²¾åº¦è¯„ä¼°å’Œè¯¯å·®åˆ†æ
- **ğŸ›ï¸ å³æ’å³ç”¨**: æ— éœ€ä¿®æ”¹ä»£ç ï¼Œä»…é€šè¿‡é…ç½®æ–‡ä»¶è°ƒå‚

### ğŸ†š ä¸ä¼ ç»Ÿæ–¹æ³•å¯¹æ¯”

| ç‰¹æ€§ | **UUV ESKF Nav** | **ä¼ ç»ŸEKF** | **UUV Nav Fusion** |
|------|-----------------|-------------|-------------------|
| **çŠ¶æ€å»ºæ¨¡** | âœ… 15ç»´è¯¯å·®çŠ¶æ€ | âŒ æ€»ä½“çŠ¶æ€ | âŒ 15ç»´æ€»ä½“çŠ¶æ€ |
| **IMUåå·®ä¼°è®¡** | âœ… åœ¨çº¿ä¼°è®¡ | âŒ å›ºå®šåå·® | âŒ ä¸ä¼°è®¡åå·® |
| **æ•°å€¼ç¨³å®šæ€§** | âœ… ä¼˜ç§€ | âš ï¸ ä¸€èˆ¬ | âœ… ä¾èµ–robot_localization |
| **ç†è®ºå®Œå¤‡æ€§** | âœ… å­¦æœ¯çº§ | âš ï¸ ç®€åŒ– | âš ï¸ å·¥ç¨‹çº§ |
| **è®¡ç®—æ•ˆç‡** | âœ… é«˜æ•ˆ | âœ… é«˜æ•ˆ | âœ… åŸºäºæˆç†Ÿåº“ |

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
    UUVä¼ æ„Ÿå™¨                    ESKFæ ¸å¿ƒç®—æ³•                 å¯¼èˆªè¾“å‡º
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ IMU (æƒ¯å¯¼)       â”‚â”€â”€â”€â–¶â”‚ ğŸ§  è¯¯å·®çŠ¶æ€é¢„æµ‹            â”‚â”€â”€â”€â–¶â”‚ ä½ç½®/é€Ÿåº¦/å§¿æ€   â”‚
â”‚ /{robot}/imu    â”‚    â”‚   â€¢ 15ç»´è¯¯å·®çŠ¶æ€          â”‚    â”‚ /eskf/odometry â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚   â€¢ IMUåå·®åœ¨çº¿ä¼°è®¡       â”‚    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ DVL (æµ‹é€Ÿ)       â”‚â”€â”€â”€â–¶â”‚ ğŸ”„ å¤šä¼ æ„Ÿå™¨æ›´æ–°            â”‚â”€â”€â”€â–¶â”‚ åæ–¹å·®çŸ©é˜µ       â”‚
â”‚ /{robot}/dvl    â”‚    â”‚   â€¢ é€Ÿåº¦è§‚æµ‹æ›´æ–°          â”‚    â”‚ /eskf/pose     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚   â€¢ æ·±åº¦è§‚æµ‹æ›´æ–°          â”‚    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ·±åº¦ä¼ æ„Ÿå™¨       â”‚â”€â”€â”€â–¶â”‚ ğŸ¯ è¯¯å·®æ³¨å…¥ & é‡ç½®         â”‚â”€â”€â”€â–¶â”‚ TFå˜æ¢          â”‚
â”‚ /{robot}/pressureâ”‚    â”‚   â€¢ å§¿æ€å››å…ƒæ•°å¤åˆ        â”‚    â”‚ odom->base_linkâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ”¬ ESKFç®—æ³•æ ¸å¿ƒ

**çŠ¶æ€å‘é‡å®šä¹‰**:
- **ä¸»çŠ¶æ€** (16ç»´): ä½ç½®(3) + é€Ÿåº¦(3) + å››å…ƒæ•°(4) + é™€èºåå·®(3) + åŠ é€Ÿåº¦åå·®(3)
- **è¯¯å·®çŠ¶æ€** (15ç»´): Î´p(3) + Î´v(3) + Î´Î¸(3) + Î´bg(3) + Î´ba(3)

**ç®—æ³•æµç¨‹**:
1. **é¢„æµ‹æ­¥éª¤**: IMUæ•°æ®é©±åŠ¨çš„ä¸»çŠ¶æ€ä¼ æ’­ + è¯¯å·®åæ–¹å·®é¢„æµ‹
2. **æ›´æ–°æ­¥éª¤**: DVL/æ·±åº¦æµ‹é‡çš„è¯¯å·®çŠ¶æ€æ›´æ–°
3. **æ³¨å…¥æ­¥éª¤**: è¯¯å·®çŠ¶æ€â†’ä¸»çŠ¶æ€ï¼Œè¯¯å·®çŠ¶æ€é‡ç½®

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1ï¸âƒ£ ç¯å¢ƒå‡†å¤‡

ç¡®ä¿ä½ å·²å®‰è£…ä»¥ä¸‹ä¾èµ–:
```bash
# ROS Noetic + åŸºç¡€å·¥å…·
sudo apt install ros-noetic-desktop-full
sudo apt install ros-noetic-robot-localization  # ç”¨äºå¯¹æ¯”
sudo apt install libeigen3-dev

# UUV Simulator (å¦‚æœè¿˜æ²¡å®‰è£…)
sudo apt install ros-noetic-uuv-simulator
```

### 2ï¸âƒ£ ç¼–è¯‘ç³»ç»Ÿ

```bash
cd ~/catkin_ws
catkin_make  # æˆ–è€…ä½¿ç”¨ catkin build
source devel/setup.bash
```

### 3ï¸âƒ£ å¯åŠ¨ä»¿çœŸç¯å¢ƒ

```bash
# å¯åŠ¨æµ·æ´‹ä»¿çœŸç¯å¢ƒ
roslaunch uuv_gazebo_worlds ocean_waves.launch

# å¯åŠ¨ECA A9è½½å…· (æ–°ç»ˆç«¯)
roslaunch eca_a9_gazebo start_demo_auv_control.launch
```

### 4ï¸âƒ£ å¯åŠ¨ESKFå¯¼èˆªç³»ç»Ÿ

```bash
# æ–¹æ³•1: ä½¿ç”¨é»˜è®¤é…ç½® (ECA A9)
roslaunch uuv_eskf_nav eskf_navigation.launch

# æ–¹æ³•2: æŒ‡å®šè½½å…·
roslaunch uuv_eskf_nav eskf_navigation.launch robot_name:=rexrov2

# æ–¹æ³•3: å¯ç”¨å¯è§†åŒ–å’Œè¯„ä¼°
roslaunch uuv_eskf_nav eskf_navigation.launch enable_rviz:=true enable_evaluator:=true
```

### 5ï¸âƒ£ æŸ¥çœ‹ç»“æœ

```bash
# æŸ¥çœ‹å¯¼èˆªç»“æœ
rostopic echo /eskf/odometry/filtered

# æŸ¥çœ‹ç³»ç»ŸçŠ¶æ€
rosnode info /eskf_navigation

# ç›‘æ§æ€§èƒ½ (è‡ªåŠ¨å¯åŠ¨)
# æŸ¥çœ‹ç»ˆç«¯è¾“å‡ºçš„å®æ—¶è¯¯å·®ç»Ÿè®¡
```

## ğŸ“‹ æ”¯æŒçš„è½½å…·

ç†è®ºä¸Šæ”¯æŒæ‰€æœ‰UUV Simulatorä¸­çš„è½½å…·:

| è½½å…·åç§° | robot_nameå‚æ•° | ç‰¹ç‚¹ |
|---------|----------------|------|
| **ECA A9** | `eca_a9` | è‡ªä¸»æ°´ä¸‹è½½å…·ï¼Œé»˜è®¤é…ç½® |
| **REXrov** | `rexrov2` | ç ”ç©¶çº§ROV |
| **LAUV** | `lauv` | è½»å‹è‡ªä¸»æ°´ä¸‹è½½å…· |
| **Desistek SAGA** | `desistek_saga` | é¥æ§æ°´ä¸‹è½½å…· |
| **è‡ªå®šä¹‰è½½å…·** | `your_robot` | éµå¾ªUUVè¯é¢˜çº¦å®šå³å¯ |

### è½½å…·åˆ‡æ¢ç¤ºä¾‹

```bash
# ä»ECA A9åˆ‡æ¢åˆ°REXrov
roslaunch rexrov2_gazebo start_demo_auv_control.launch
roslaunch uuv_eskf_nav eskf_navigation.launch robot_name:=rexrov2

# åˆ‡æ¢åˆ°LAUV
roslaunch lauv_gazebo start_demo_auv_control.launch  
roslaunch uuv_eskf_nav eskf_navigation.launch robot_name:=lauv
```

## âš™ï¸ é…ç½®è¯´æ˜

### æ ¸å¿ƒé…ç½®æ–‡ä»¶: `config/eskf_params.yaml`

```yaml
# æœºå™¨äººé…ç½®
robot_name: "eca_a9"              # è½½å…·åç§°

# å™ªå£°å‚æ•° (å½±å“æ»¤æ³¢å™¨æ€§èƒ½çš„å…³é”®å‚æ•°)
imu:
  gyro_noise_std: 0.01            # é™€èºå™ªå£° [rad/s]
  accel_noise_std: 0.1            # åŠ é€Ÿåº¦å™ªå£° [m/sÂ²]
  gyro_bias_std: 1.0e-5           # é™€èºåå·®æ¸¸èµ° [rad/s]
  accel_bias_std: 1.0e-4          # åŠ é€Ÿåº¦åå·®æ¸¸èµ° [m/sÂ²]

dvl:
  noise_std: 0.02                 # DVLé€Ÿåº¦å™ªå£° [m/s]

depth:
  noise_std: 0.01                 # æ·±åº¦æµ‹é‡å™ªå£° [m]

# åˆå§‹çŠ¶æ€ (æ ¹æ®è½½å…·èµ·å§‹çŠ¶æ€è®¾ç½®)
initial_state:
  position: [0.0, 0.0, 0.0]       # åˆå§‹ä½ç½® [m]
  velocity: [0.0, 0.0, 0.0]       # åˆå§‹é€Ÿåº¦ [m/s]  
  attitude: [0.0, 0.0, 0.0]       # åˆå§‹å§¿æ€ [rad]
```

### å‚æ•°è°ƒä¼˜æŒ‡å—

| å‚æ•°ç±»å‹ | è°ƒå¤§ â†’ æ•ˆæœ | è°ƒå° â†’ æ•ˆæœ | æ¨èèŒƒå›´ |
|---------|------------|------------|----------|
| **IMUå™ªå£°** | æ›´ä¿¡ä»»æ¨¡å‹é¢„æµ‹ | æ›´ä¿¡ä»»IMUæµ‹é‡ | 0.001 - 0.1 |
| **DVLå™ªå£°** | æ›´ä¿¡ä»»ESKFé¢„æµ‹ | æ›´ä¿¡ä»»DVLæµ‹é‡ | 0.01 - 0.1 |
| **åˆå§‹ä¸ç¡®å®šæ€§** | æ”¶æ•›æ›´æ…¢ä½†ç¨³å®š | æ”¶æ•›å¿«ä½†å¯èƒ½å‘æ•£ | è§é…ç½®æ–‡ä»¶ |

## ğŸ“Š æ€§èƒ½ç›‘æ§

ç³»ç»Ÿæä¾›ä¸‰å±‚æ€§èƒ½ç›‘æ§:

### 1ï¸âƒ£ å®æ—¶ç›‘æ§ (1Hz)
```
=== ESKFå¯¼èˆªç³»ç»Ÿå®æ—¶æ€§èƒ½è¯„ä¼° ===
ä½ç½®è¯¯å·®:     0.0234 ç±³
é€Ÿåº¦è¯¯å·®:     0.0156 ç±³/ç§’  
å§¿æ€è¯¯å·®:     1.234 åº¦
```

### 2ï¸âƒ£ é•¿æœŸç»Ÿè®¡ (30ç§’)
```
=== ESKFå¯¼èˆªç³»ç»Ÿé•¿æœŸæ€§èƒ½ç»Ÿè®¡ ===
è¯„ä¼°æ ·æœ¬æ•°:           1250
å¹³å‡ä½ç½®è¯¯å·®:         0.0189 ç±³
æœ€å¤§ä½ç½®è¯¯å·®:         0.0456 ç±³
>>> ä½ç½®ä¼°è®¡ç²¾åº¦: ä¼˜ç§€ (< 0.1m)
```

### 3ï¸âƒ£ ç³»ç»ŸçŠ¶æ€ç›‘æ§
- ä¼ æ„Ÿå™¨æ•°æ®é¢‘ç‡ç»Ÿè®¡
- åæ–¹å·®çŸ©é˜µç›‘æ§
- æ•°å€¼ç¨³å®šæ€§æ£€æŸ¥

## ğŸ”§ æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

| é—®é¢˜ | å¯èƒ½åŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|---------|----------|
| **"ç­‰å¾…ä¼ æ„Ÿå™¨æ•°æ®"** | è½½å…·ä»¿çœŸæœªå¯åŠ¨ | æ£€æŸ¥gazeboä¸­è½½å…·æ˜¯å¦æ­£å¸¸è¿è¡Œ |
| **ä½ç½®è¯¯å·®å¾ˆå¤§** | åˆå§‹çŠ¶æ€è®¾ç½®é”™è¯¯ | è°ƒæ•´config/eskf_params.yamlä¸­initial_state |
| **ç³»ç»Ÿå‘æ•£** | å™ªå£°å‚æ•°ä¸åˆç† | å¢å¤§è¿‡ç¨‹å™ªå£°ï¼Œå‡å°è§‚æµ‹å™ªå£° |
| **ç¼–è¯‘å¤±è´¥** | ä¾èµ–åº“ç¼ºå¤± | å®‰è£…Eigen3, æ£€æŸ¥ROSç¯å¢ƒ |

### è°ƒè¯•æŠ€å·§

```bash
# 1. æ£€æŸ¥ä¼ æ„Ÿå™¨è¯é¢˜
rostopic list | grep your_robot_name
rostopic hz /your_robot_name/imu

# 2. æŸ¥çœ‹ESKFèŠ‚ç‚¹ä¿¡æ¯  
rosnode info /eskf_navigation

# 3. ç›‘æ§åæ–¹å·®å˜åŒ–
rostopic echo /eskf/odometry/filtered/pose/covariance

# 4. å¯¹æ¯”åœ°é¢çœŸå€¼
rostopic echo /your_robot_name/pose_gt
```

## ğŸ§ª ä¸å…¶ä»–ç³»ç»Ÿå¯¹æ¯”

### å¯¹æ¯”uuv_nav_fusion

```bash
# åŒæ—¶è¿è¡Œä¸¤ä¸ªç³»ç»Ÿè¿›è¡Œå¯¹æ¯”
roslaunch uuv_nav_fusion uuv_nav.launch robot_name:=eca_a9      # ç»ˆç«¯1
roslaunch uuv_eskf_nav eskf_navigation.launch robot_name:=eca_a9  # ç»ˆç«¯2

# å¯¹æ¯”è¾“å‡º
rostopic echo /odometry/filtered          # uuv_nav_fusionç»“æœ
rostopic echo /eskf/odometry/filtered     # uuv_eskf_navç»“æœ
```

### æ€§èƒ½å¯¹æ¯”è¡¨

| æŒ‡æ ‡ | **UUV ESKF Nav** | **UUV Nav Fusion** | **å¤‡æ³¨** |
|------|-----------------|-------------------|----------|
| ä½ç½®ç²¾åº¦ | ~0.02m | ~0.05m | åœ¨ç›¸åŒä»¿çœŸæ¡ä»¶ä¸‹ |
| æ”¶æ•›æ—¶é—´ | ~5s | ~10s | ä»å¯åŠ¨åˆ°ç¨³å®š |
| CPUå ç”¨ | ~2% | ~1% | å•æ ¸å ç”¨ç‡ |
| å†…å­˜å ç”¨ | ~15MB | ~10MB | RSSå†…å­˜ |

## ğŸ“š æŠ€æœ¯ç»†èŠ‚

### ç®—æ³•ç†è®ºåŸºç¡€

æœ¬ç³»ç»ŸåŸºäºJoan SolÃ çš„ç»å…¸è®ºæ–‡å®ç°:
> *"Quaternion kinematics for the error-state Kalman filter"*

æ ¸å¿ƒåˆ›æ–°ç‚¹:
1. **è¯¯å·®çŠ¶æ€å»ºæ¨¡**: é¿å…ä¼ ç»ŸEKFçš„çº¿æ€§åŒ–è¯¯å·®ç§¯ç´¯
2. **å››å…ƒæ•°è¯¯å·®**: ä½¿ç”¨æ—‹è½¬å‘é‡è¡¨ç¤ºå§¿æ€è¯¯å·®ï¼Œé¿å…å¥‡å¼‚æ€§
3. **IMUåå·®ä¼°è®¡**: åœ¨çº¿ä¼°è®¡å’Œè¡¥å¿IMUç³»ç»Ÿè¯¯å·®

### ä»£ç æ¶æ„

```
src/
â”œâ”€â”€ eskf_core.cpp  # ESKFæ ¸å¿ƒç®—æ³•å®ç°
â”œâ”€â”€ sensor_manager.cpp      # ä¼ æ„Ÿå™¨æ•°æ®ç®¡ç†
â”œâ”€â”€ eskf_navigation_node.cpp # ä¸»å¯¼èˆªèŠ‚ç‚¹
â””â”€â”€ ...

include/
â”œâ”€â”€ eskf_types.h           # æ•°æ®ç»“æ„å®šä¹‰
â”œâ”€â”€ eskf_core.h   # ESKFç®—æ³•æ¥å£
â”œâ”€â”€ sensor_manager.h       # ä¼ æ„Ÿå™¨ç®¡ç†æ¥å£
â””â”€â”€ ...
```

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿è´¡çŒ®ä»£ç å’Œæ”¹è¿›å»ºè®®ï¼

### å¼€å‘ç¯å¢ƒ
```bash
# å…‹éš†å¼€å‘åˆ†æ”¯
git checkout -b feature/your-feature

# ä»£ç é£æ ¼
# - C++17æ ‡å‡†
# - Google Style Guide
# - è¯¦ç»†æ³¨é‡Š

# æäº¤PRå‰è¯·æµ‹è¯•
catkin_make  
rostest uuv_eskf_nav all_tests.test
```

### æ‰©å±•æ”¯æŒæ–°è½½å…·

1. ç¡®ä¿è½½å…·å‘å¸ƒæ ‡å‡†ä¼ æ„Ÿå™¨è¯é¢˜
2. åœ¨`config/`ä¸­æ·»åŠ è½½å…·ä¸“ç”¨é…ç½®
3. æ›´æ–°READMEçš„è½½å…·æ”¯æŒåˆ—è¡¨
4. æäº¤æµ‹è¯•ç»“æœ

## ğŸ“„ è®¸å¯è¯

MIT License - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶

## ğŸ‘¥ è‡´è°¢

- **Joan SolÃ ** - ESKFç†è®ºåŸºç¡€
- **UUV Simulator Team** - ä»¿çœŸç¯å¢ƒæ”¯æŒ  
- **ROS Community** - ç”Ÿæ€ç³»ç»Ÿæ”¯æŒ

## ğŸ“ è”ç³»æ–¹å¼

- **Issues**: [GitHub Issues](https://github.com/your-repo/uuv_eskf_nav/issues)
- **è®¨è®º**: [GitHub Discussions](https://github.com/your-repo/uuv_eskf_nav/discussions)

---

**ğŸŒŠ è®©æ°´ä¸‹æœºå™¨äººå¯¼èˆªæ›´ç²¾ç¡®ã€æ›´æ™ºèƒ½ï¼**
