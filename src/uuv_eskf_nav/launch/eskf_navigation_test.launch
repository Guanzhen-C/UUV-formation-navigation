<launch>
    <!-- 
    æ”¹è¿›ESKFæ°´ä¸‹è½½å…·å¯¼èˆªæµ‹è¯•ç³»ç»Ÿ
    - å¯åŠ¨æ”¹è¿›ESKFå¯¼èˆª
    - åœ¨RVizä¸­ç»˜åˆ¶çœŸå€¼ä¸Žä¼°è®¡è½¨è¿¹å¯¹æ¯”
    - æä¾›è¯¦ç»†çš„ç²¾åº¦åˆ†æžå’Œå¯è§†åŒ–
    
    ä½¿ç”¨æ–¹æ³•ï¼š
      # 1. å…ˆå¯åŠ¨AUVä»¿çœŸ (åœ¨å¦ä¸€ä¸ªç»ˆç«¯)
      roslaunch eca_a9_gazebo start_pid_demo.launch
      
      # 2. å¯åŠ¨ESKFå¯¼èˆªæµ‹è¯•
      roslaunch uuv_eskf_nav eskf_navigation_test.launch robot_name:=eca_a9
    -->
    
    <!-- æ ¸å¿ƒå‚æ•°ï¼šæœºå™¨äººåç§° -->
    <arg name="robot_name" default="eca_a9"/>
    
    <!-- åæ ‡ç³»å‚æ•° -->
    <arg name="odom_frame" default="odom"/>
    <arg name="base_link_frame" default="$(arg robot_name)/base_link"/>
    <arg name="world_frame" default="odom"/>

    <!-- å¯åŠ¨æ”¹è¿›ESKFå¯¼èˆªèŠ‚ç‚¹ (æ›¿ä»£robot_localization) -->
    <node pkg="uuv_eskf_nav" type="eskf_navigation_node" name="eskf_navigation_node" output="screen">
        <param name="robot_name" value="$(arg robot_name)"/>
        <param name="odom_frame" value="$(arg odom_frame)"/>
        <param name="base_link_frame" value="$(arg base_link_frame)"/>
        <param name="world_frame" value="$(arg world_frame)"/>
        
        <!-- åŠ è½½ESKFå‚æ•° -->
        <rosparam command="load" file="$(find uuv_eskf_nav)/config/eskf_params.yaml" />
        
        <!-- å°†ESKFè¾“å‡ºé‡æ˜ å°„ä¸ºæ ‡å‡†çš„filteredè¯é¢˜ -->
        <remap from="eskf/odometry" to="/odometry/filtered"/>
    </node>

    <!-- å¯åŠ¨å¢žå¼ºç‰ˆå¯¼èˆªè¯„ä¼°å™¨ (æ”¯æŒRVizè½¨è¿¹ç»˜åˆ¶) -->
    <node pkg="uuv_eskf_nav" type="enhanced_navigation_evaluator.py" name="enhanced_navigation_evaluator" output="screen">
        <param name="robot_name" value="$(arg robot_name)"/>
        <param name="enable_rviz_visualization" value="true"/>
        <param name="publish_error_statistics" value="true"/>
        <param name="trajectory_history_length" value="1000"/>  <!-- ä¿å­˜1000ä¸ªè½¨è¿¹ç‚¹ -->
        <param name="evaluation_frequency" value="10.0"/>      <!-- 10Hzè¯„ä¼°é¢‘çŽ‡ -->
    </node>
    
    <!-- å¯é€‰ï¼šå¯åŠ¨RVizè¿›è¡Œå¯è§†åŒ– -->
    <arg name="start_rviz" default="true"/>
    <node if="$(arg start_rviz)" 
          pkg="rviz" type="rviz" name="eskf_navigation_rviz" 
          args="-d $(find uuv_eskf_nav)/config/navigation_test.rviz"/>
    
    <!-- ðŸŽ¯ å…³é”®ä¿®å¤ï¼šå¯åŠ¨ä¼ æ„Ÿå™¨æ•°æ®é¢„å¤„ç†èŠ‚ç‚¹ (åæ ‡ç³»å˜æ¢) -->
    <arg name="use_sensor_processor" default="true"/>
    <node if="$(arg use_sensor_processor)" 
          pkg="uuv_nav_fusion" type="sensor_processor.py" name="sensor_processor" output="screen">
        <param name="robot_name" value="$(arg robot_name)"/>
        <param name="odom_frame" value="$(arg odom_frame)"/>
        <param name="base_link_frame" value="$(arg base_link_frame)"/>
    </node>

    <!-- æ˜¾ç¤ºå¯åŠ¨ä¿¡æ¯ -->
    <node pkg="uuv_eskf_nav" type="startup_message.py" name="test_startup_message" output="screen">
        <param name="message" value="ðŸ§ª æ”¹è¿›ESKFå¯¼èˆªç²¾åº¦æµ‹è¯•ç³»ç»Ÿå·²å¯åŠ¨ï¼"/>
        <param name="robot_name" value="$(arg robot_name)"/>
    </node>
</launch>
