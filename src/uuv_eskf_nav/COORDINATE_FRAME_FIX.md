# ğŸ¯ å…³é”®ä¿®å¤ï¼šåæ ‡ç³»å˜æ¢é—®é¢˜è§£å†³æ–¹æ¡ˆ

## ğŸ“‹ é—®é¢˜è¯Šæ–­

### ğŸš¨ **åŸå§‹é—®é¢˜**
æˆ‘ä»¬çš„ESKFå¯¼èˆªç³»ç»Ÿå‡ºç°**å·¨å¤§è¯¯å·®**ï¼š
- **DVLè§‚æµ‹æ®‹å·®**: `68+ m/s` (å®Œå…¨ä¸åˆç†!)
- **æ·±åº¦è§‚æµ‹æ®‹å·®**: `128+ m` (å·¨å¤§åå·®!)
- **ä½ç½®è¯¯å·®**: å‡ åƒç±³çº§åˆ«çš„å‘æ•£

### ğŸ” **æ ¹æœ¬åŸå› å‘ç°**
ç”¨æˆ·æä¾›äº†**å…³é”®çº¿ç´¢**ï¼š
> "æˆ‘è®°å¾—uuv_nav_fusionæ˜¯æœ‰ä¸€ä¸ªæ•°æ®é¢„å¤„ç†çš„æ­¥éª¤ï¼Œæˆ‘å½“åˆè°ƒè¯•è¿™ä¸ªç®—æ³•çš„æ—¶å€™ï¼Œæœ€åæŠŠdvlçš„åæ ‡ç³»å˜æ¢äº†ä¸€ä¸‹ï¼Œæœ€ç»ˆå¯¼èˆªè¯¯å·®æ‰ç‰¹åˆ«å°"

**åˆ†æå‘ç°**ï¼š
1. **DVLä¼ æ„Ÿå™¨æ•°æ®**åœ¨`eca_a9/dvl_link`åæ ‡ç³»ä¸­
2. **ESKFçŠ¶æ€ä¼°è®¡**åœ¨`eca_a9/base_link`åæ ‡ç³»ä¸­
3. **æˆ‘ä»¬ç›´æ¥æ¯”è¾ƒä¸¤ä¸ªä¸åŒåæ ‡ç³»çš„æ•°æ®** âŒ

## ğŸ”§ **ä¿®å¤æ–¹æ¡ˆ**

### **æ–¹æ¡ˆé€‰æ‹©**
âŒ **æ–¹æ¡ˆA**: åœ¨ESKFä¸­å®ç°TFåæ ‡å˜æ¢
âœ… **æ–¹æ¡ˆB**: ä½¿ç”¨`sensor_processor.py`é¢„å¤„ç†åçš„æ ‡å‡†è¯é¢˜

### **å…·ä½“ä¿®å¤**

#### 1ï¸âƒ£ **ä¿®æ”¹ä¼ æ„Ÿå™¨è®¢é˜…è¯é¢˜**
```cpp
// ğŸš¨ ä¿®å¤å‰ï¼šè®¢é˜…åŸå§‹ä¼ æ„Ÿå™¨æ•°æ®
std::string dvl_topic = "/" + robot_name_ + "/dvl";      // åŸå§‹DVL (dvl_linkåæ ‡ç³»)
std::string pressure_topic = "/" + robot_name_ + "/pressure";  // åŸå§‹å‹åŠ›

// âœ… ä¿®å¤åï¼šè®¢é˜…é¢„å¤„ç†åçš„æ ‡å‡†è¯é¢˜  
std::string dvl_topic = "dvl/twist";          // é¢„å¤„ç†DVL (å·²åæ ‡ç³»å˜æ¢)
std::string pressure_topic = "depth/pose";   // é¢„å¤„ç†æ·±åº¦ (odomåæ ‡ç³»ï¼ŒZä¸ºè´Ÿ)
```

#### 2ï¸âƒ£ **æ–°å¢é¢„å¤„ç†å›è°ƒå‡½æ•°**
```cpp
// å¤„ç†å·²åæ ‡ç³»å˜æ¢çš„DVLæ•°æ®
void dvlProcessedCallback(const geometry_msgs::TwistWithCovarianceStamped::ConstPtr& msg);

// å¤„ç†å·²æ ¼å¼åŒ–çš„æ·±åº¦æ•°æ®  
void depthProcessedCallback(const geometry_msgs::PoseWithCovarianceStamped::ConstPtr& msg);
```

#### 3ï¸âƒ£ **å¯ç”¨sensor_processor.py**
```xml
<!-- ğŸ¯ å…³é”®ä¿®å¤ï¼šå¯åŠ¨ä¼ æ„Ÿå™¨æ•°æ®é¢„å¤„ç†èŠ‚ç‚¹ (åæ ‡ç³»å˜æ¢) -->
<arg name="use_sensor_processor" default="true"/>
<node pkg="uuv_nav_fusion" type="sensor_processor.py" name="sensor_processor" output="screen">
```

## ğŸ“Š **é¢„å¤„ç†èŠ‚ç‚¹çš„ä½œç”¨**

### **åŸå§‹uuv_nav_fusionçš„æ™ºæ…§**
`sensor_processor.py`æ‰§è¡Œå…³é”®çš„æ•°æ®é¢„å¤„ç†ï¼š

#### **DVLæ•°æ®å¤„ç†**:
```python
twist_msg.header.frame_id = self.dvl_link_frame  # æŒ‡å®šDVLåæ ‡ç³»
twist_msg.twist.twist.linear = msg.velocity       # å¤åˆ¶é€Ÿåº¦æ•°æ®
# robot_localizationä¼šè‡ªåŠ¨è¿›è¡ŒTFåæ ‡å˜æ¢ï¼
```

#### **æ·±åº¦æ•°æ®å¤„ç†**:
```python
depth_m = (pressure_kpa - ATM_PRESSURE_KPA) / KPA_PER_METER
pose_msg.pose.pose.position.z = -depth_m  # ğŸ¯ å…³é”®ï¼šè½¬æ¢ä¸ºè´ŸZå€¼
pose_msg.header.frame_id = self.odom_frame  # odomåæ ‡ç³»
```

#### **åæ–¹å·®å¤„ç†**:
```python
# DVLåæ–¹å·®
twist_msg.twist.covariance[0] = 0.01   # Xé€Ÿåº¦æ–¹å·®
twist_msg.twist.covariance[7] = 0.01   # Yé€Ÿåº¦æ–¹å·®  
twist_msg.twist.covariance[14] = 0.01  # Zé€Ÿåº¦æ–¹å·®

# æ·±åº¦åæ–¹å·®
pose_msg.pose.covariance = np.diag([
    9999.0, 9999.0, 0.01,   # X, Y, Z (åªä¿¡ä»»Z)
    9999.0, 9999.0, 9999.0  # Roll, Pitch, Yaw
])
```

## ğŸ¯ **robot_localizationçš„é…ç½®æ™ºæ…§**

### **EKFé…ç½®å…³é”®ç‚¹**:
```yaml
# DVLé…ç½®
twist0: dvl/twist
twist0_frame_id: dvl_link  # ğŸ¯ æŒ‡å®šåæ ‡ç³»ï¼ŒEKFä¼šè‡ªåŠ¨TFå˜æ¢ï¼
twist0_config: [false, false, false,
                false, false, false, 
                true,  true,  true,   # èåˆæ‰€æœ‰çº¿é€Ÿåº¦
                false, false, false,
                false, false, false]

# æ·±åº¦é…ç½®
pose0: depth/pose
pose0_config: [false, false, true,   # åªèåˆZè½´ä½ç½®
               false, false, false,
               false, false, false, 
               false, false, false,
               false, false, false]
```

## ğŸ”¬ **æŠ€æœ¯åŸç†**

### **åæ ‡ç³»å±‚æ¬¡**:
```
world (ENU)
 â””â”€â”€ odom
     â””â”€â”€ eca_a9/base_link
         â”œâ”€â”€ eca_a9/dvl_link      (DVLä¼ æ„Ÿå™¨ä½ç½®)
         â”œâ”€â”€ eca_a9/imu_link      (IMUä¼ æ„Ÿå™¨ä½ç½®)  
         â””â”€â”€ eca_a9/pressure_link (æ·±åº¦ä¼ æ„Ÿå™¨ä½ç½®)
```

### **æ•°æ®æµå‘**:
```
åŸå§‹ä¼ æ„Ÿå™¨æ•°æ® (å„è‡ªåæ ‡ç³»)
        â†“
sensor_processor.py (é¢„å¤„ç† + åæ ‡ç³»æ ‡è®°)
        â†“
æ ‡å‡†è¯é¢˜ (ç»Ÿä¸€æ ¼å¼ + åæ ‡ç³»ä¿¡æ¯)
        â†“
robot_localization / ESKF (è‡ªåŠ¨TFå˜æ¢)
        â†“
ç»Ÿä¸€åæ ‡ç³»ä¸‹çš„èåˆç»“æœ
```

## ğŸ“ˆ **é¢„æœŸæ•ˆæœ**

### **ä¿®å¤å‰**:
- DVLæ®‹å·®: `68+ m/s` 
- æ·±åº¦æ®‹å·®: `128+ m`
- ä½ç½®è¯¯å·®: `å‡ åƒç±³`

### **ä¿®å¤åé¢„æœŸ**:
- DVLæ®‹å·®: `< 0.1 m/s`
- æ·±åº¦æ®‹å·®: `< 0.1 m` 
- ä½ç½®è¯¯å·®: `< 1 m`

## ğŸ‰ **ä¿®å¤éªŒè¯æ­¥éª¤**

1. **å¯åŠ¨ä»¿çœŸ**: `roslaunch uuv_gazebo_worlds ocean_waves.launch`
2. **å¯åŠ¨AUV**: `roslaunch eca_a9_gazebo start_demo_auv_control.launch`
3. **å¯åŠ¨ä¿®å¤åçš„ESKF**: `roslaunch uuv_eskf_nav eskf_navigation_test.launch`
4. **è§‚å¯Ÿè¯¯å·®**: åº”è¯¥çœ‹åˆ°æ­£å¸¸çš„å°è¯¯å·®å€¼

## ğŸ’¡ **æŠ€æœ¯å¯ç¤º**

### **å…³é”®ç»éªŒ**:
1. **åæ ‡ç³»ä¸€è‡´æ€§æ˜¯å¯¼èˆªç³»ç»Ÿçš„ç”Ÿå‘½çº¿**
2. **é¢„å¤„ç†æ­¥éª¤ä¸å¯å¿½è§†ï¼Œé€šå¸¸éšå«é‡è¦çš„å·¥ç¨‹æ™ºæ…§**
3. **å¤§çš„è§‚æµ‹æ®‹å·®é€šå¸¸æŒ‡å‘åæ ‡ç³»æˆ–å•ä½é—®é¢˜**
4. **å¼€æºç³»ç»Ÿçš„é…ç½®æ–‡ä»¶åŒ…å«çè´µçš„è°ƒè¯•ç»éªŒ**

### **è°ƒè¯•æ–¹æ³•è®º**:
1. **å¯¹æ¯”æˆåŠŸç³»ç»Ÿ**ï¼šåˆ†æå·¥ä½œç³»ç»Ÿçš„æ•°æ®æµ
2. **è¿½è¸ªæ•°æ®æºå¤´**ï¼šä»åŸå§‹ä¼ æ„Ÿå™¨åˆ°èåˆç»“æœçš„å®Œæ•´è·¯å¾„
3. **éªŒè¯åæ ‡ç³»**ï¼šç¡®ä¿æ‰€æœ‰æ•°æ®åœ¨ç»Ÿä¸€åæ ‡ç³»ä¸‹æ¯”è¾ƒ
4. **æ£€æŸ¥é¢„å¤„ç†**ï¼šä¸è¦å¿½è§†çœ‹ä¼¼ç®€å•çš„æ•°æ®è½¬æ¢æ­¥éª¤

---

## ğŸ¯ **æ€»ç»“**

è¿™æ¬¡ä¿®å¤è¯æ˜äº†**ç”¨æˆ·çš„è°ƒè¯•ç»éªŒéå¸¸å®è´µ**ï¼åæ ‡ç³»å˜æ¢é—®é¢˜æ˜¯å¯¼èˆªç³»ç»Ÿä¸­æœ€å®¹æ˜“è¢«å¿½è§†ä½†å½±å“æœ€å¤§çš„é—®é¢˜ä¹‹ä¸€ã€‚

é€šè¿‡é‡‡ç”¨ä¸`robot_localization`å…¼å®¹çš„é¢„å¤„ç†æ–¹æ¡ˆï¼Œæˆ‘ä»¬çš„ESKFç³»ç»Ÿåº”è¯¥èƒ½è¾¾åˆ°ä¸åŸå§‹ç³»ç»Ÿç›¸å½“ç”šè‡³æ›´å¥½çš„ç²¾åº¦è¡¨ç°ï¼

**æ„Ÿè°¢ç”¨æˆ·æä¾›çš„å…³é”®çº¿ç´¢ï¼** ğŸ™
